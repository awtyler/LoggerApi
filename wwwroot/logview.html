<!DOCTYPE html>
<html>
	<head>
		<script src="/js/jquery-3.4.1.min.js"></script>
		<script src="/js/popper.min.js"></script>
		<link rel="stylesheet" href="/lib/bootstrap-4.4.1-dist/css/bootstrap.min.css">
		<script src="/lib/bootstrap-4.4.1-dist/js/bootstrap.bundle.min.js"></script>
		<style>
			html, body {
				height: 100%;
			}
		</style>
		<script>
			$(document).ready(function() {
				$.get("/Log/LogNames", function(data, status) {
					for(item of data) {
						$("#logSelect").append(
							`<option value='${item}' ${item == "default" ? "SELECTED" : ""}>
								${item}
							</option>`);
					}
				});
			});
			
			var reloadInterval;

			function clearLog() {
				if(confirm("Are you sure you want to clear the log?")) {
					$.get(`/Log/Clear?log=${log}`, function() {
						reloadIframe();
					});
				}
			}
			
			function reloadIframe() {
				$("#logFrame").attr("src", `/ShowLog?log=${log}`);
			}

			function toggleReloadIframe() {
				if(reloadInterval) {
					clearInterval(reloadInterval);
					reloadInterval = null;
					$("#reloadButton").html("Start Reload").addClass("btn-success").removeClass("btn-danger");
				} else {
					reloadInterval = setInterval(function() {
						reloadIframe();
					}, 1000);
					$("#reloadButton").html("Stop Reload").addClass("btn-danger").removeClass("btn-success");
				}

			}

			function scrollIframe(frame) {
				frame.contentWindow.scrollBy(0, 100000);
			}

			var log = "default"
			function selectChanged(field) {
				log = field.value;
				reloadIframe();
			}

		</script>
	</head>
	<body>
		<div class="d-flex flex-column" style="width: 100%; height: 100%; min-height: 100%;">
		<div class="card bg-light m-3 flex-grow-1">
			<div class="card-header">
				<h1 class="float-left">Log View</h1>
				<span class="float-left"><select class="custom-select mt-2 ml-5" id="logSelect" onchange="selectChanged(this)"></select></span>
				<button id="reloadButton" onclick="toggleReloadIframe();" class="mt-2 ml-2 btn btn-success float-right">Start Reload</button>
				<button onclick="clearLog();" class="mt-2 btn btn-danger float-right">Clear Log</button>
			</div>
			<div class="card-body d-flex flex-column p-0" style="min-height: 100%; height: 100%; ">
				<iframe src="/ShowLog?log=default" onload="scrollIframe(this)" id="logFrame" class="w-100 flex-grow-1" style="border: none;">
			</div>
		</div>
		</div>
	</body>
</html>
